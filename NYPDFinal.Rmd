---
title: "NYPD Shooting Incident Data Report (Historic)"
author: "Damlanur Onat"
date: "`10/01/2025`"
---




```{r setup, include=FALSE}
# Including libraries used in Covid Project

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)   # install.packages("tidyverse") if needed
library(lubridate)   # install.packages("lubridate")
library(scales)
library(ggplot2)
library(dplyr)
library(stringr)

set.seed(42)

```


```{r}
source_url <- "https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD"

raw <- readr::read_csv(source_url, show_col_types = FALSE)

cat("Rows:", nrow(raw), "  Cols:", ncol(raw), "\n\nFirst 25 column names:\n")
print(head(names(raw), 25))
cat("\nPreview:\n")
print(utils::head(raw, 5))
cat("\nStructure glimpse:\n")
dplyr::glimpse(utils::head(raw, 200))

```







```{r step2_tidy_transform_upper}

# --- STEP 2 for your columns: cmplnt_num / addr_pct_cd / boro_nm / cmplnt_fr_dt ---

shootings <- raw %>%
  transmute(
    incident_key  = as.character(INCIDENT_KEY),
    # OCCUR_DATE is typically "MM/DD/YYYY" → use mdy()
    incident_date = mdy(OCCUR_DATE),
    # If you *don't* have OCCUR_DATE but have OCCUR_DATETIME instead, comment the line above and use:
    # incident_date = ymd(substr(OCCUR_DATETIME, 1, 10)),
    borough       = stringr::str_to_title(BORO),
    precinct      = as.integer(PRECINCT)
  ) %>%
  mutate(
    year         = year(incident_date),
    month        = floor_date(incident_date, "month"),
    weekday      = wday(incident_date, label = TRUE, week_start = 1),
    weekend      = weekday %in% c("Sat","Sun"),
    combined_key = paste(borough, precinct, incident_date, sep = "::")
  )

# quick diagnostics
cat("N missing dates after parsing:", sum(is.na(shootings$incident_date)), "\n")
utils::head(raw$OCCUR_DATE, 5)
stopifnot(!all(is.na(shootings$incident_date)))
glimpse(shootings)

```





```{r}

```


```{r}

```


```{r}
```


```{r}

```


```{r step4_topN_boroughs, fig.width=7, fig.height=5}

```
#Step 3


```{r }

shootings_unique <- shootings %>% distinct(incident_key, .keep_all = TRUE)

# Simple counts by borough (bar chart)
bor_counts <- shootings_unique %>%
  count(borough, name = "n") %>%
  arrange(desc(n))

bor_counts

ggplot(bor_counts, aes(x = reorder(borough, n), y = n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Incidents by Borough (counts)",
       x = NULL, y = "Incidents") +
  theme_minimal(base_size = 12)

```


```{r }
# Counts by day of week (ordered Mon→Sun)
dow_counts <- shootings_unique %>%
  mutate(weekday = lubridate::wday(incident_date, label = TRUE, week_start = 1)) %>%
  count(weekday, name = "n")

dow_counts

ggplot(dow_counts, aes(x = weekday, y = n)) +
  geom_col() +
  labs(title = "Incidents by Day of Week (counts)",
       x = NULL, y = "Incidents") +
  theme_minimal(base_size = 12)

 
```


```{r }
# Counts by day of week (ordered Mon→Sun)
dow_counts <- shootings_unique %>%
  mutate(weekday = lubridate::wday(incident_date, label = TRUE, week_start = 1)) %>%
  count(weekday, name = "n")

dow_counts

ggplot(dow_counts, aes(x = weekday, y = n)) +
  geom_col() +
  labs(title = "Incidents by Day of Week (counts)",
       x = NULL, y = "Incidents") +
  theme_minimal(base_size = 12)
```


```{r}
# Top 10 precincts overall
top_precincts <- shootings_unique %>%
  filter(!is.na(precinct)) %>%
  count(precinct, name = "n") %>%
  arrange(desc(n)) %>%
  slice_head(n = 10)

top_precincts

ggplot(top_precincts, aes(x = reorder(as.factor(precinct), n), y = n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Top 10 Precincts by Incidents (counts)",
       x = "Precinct", y = "Incidents") +
  theme_minimal(base_size = 12)

```
```{r}
# Overall Male vs Female victims (drop Unknown/Other)
mf_overall <- raw %>%
  transmute(vic_sex = VIC_SEX) %>%
  filter(vic_sex %in% c("M","F")) %>%
  mutate(vic_sex = ifelse(vic_sex == "M", "Male", "Female")) %>%
  count(vic_sex, name = "n") %>%
  mutate(pct = n / sum(n),
         pct_label = paste0(round(pct*100, 1), "%"))

mf_overall

ggplot(mf_overall, aes(x = vic_sex, y = n)) +
  geom_col() +
  geom_text(aes(label = pct_label), vjust = -0.4) +
  labs(title = "Victims by Sex — Overall (counts)",
       x = NULL, y = "Victims") +
  theme_minimal(base_size = 12)

```
```{r step4_model_simple, message=FALSE, warning=FALSE}
# Build a small frame with a weekend flag (from city_daily you already made)
simple_df <- city_daily %>%
  mutate(
    weekday = lubridate::wday(incident_date, label = TRUE, week_start = 1),
    weekend = weekday %in% c("Sat", "Sun")
  )

# Linear regression: n ~ weekend  (this is just a difference in means)
m_simple <- lm(n ~ weekend, data = simple_df)

# Summary: Intercept = weekday mean; weekendTRUE = (weekend mean - weekday mean)
summary(m_simple)

# Group means and a quick, human-readable interpretation
grp_means <- simple_df %>%
  group_by(weekend) %>%
  summarise(avg = mean(n, na.rm = TRUE),
            sd = sd(n, na.rm = TRUE),
            days = n(), .groups = "drop")

weekday_mean <- grp_means$avg[grp_means$weekend == FALSE]
weekend_mean <- grp_means$avg[grp_means$weekend == TRUE]
diff_mean    <- weekend_mean - weekday_mean
ci           <- confint(m_simple)["weekendTRUE", ]  # 95% CI for the difference

cat(sprintf(
  "Weekday mean: %.2f | Weekend mean: %.2f | Difference (weekend - weekday): %.2f\n95%% CI for difference: [%.2f, %.2f]\n",
  weekday_mean, weekend_mean, diff_mean, ci[1], ci[2]
))
```
```{r  step4_model_simple_bkp, message=FALSE, warning=FALSE}
# Build a small frame with a weekend flag (from city_daily you already made)
simple_df <- city_daily %>%
  mutate(
    weekday = lubridate::wday(incident_date, label = TRUE, week_start = 1),
    weekend = weekday %in% c("Sat", "Sun")
  )

# Linear regression: n ~ weekend  (this is just a difference in means)
m_simple <- lm(n ~ weekend, data = simple_df)

# Summary: Intercept = weekday mean; weekendTRUE = (weekend mean - weekday mean)
summary(m_simple)

# Group means and a quick, human-readable interpretation
grp_means <- simple_df %>%
  group_by(weekend) %>%
  summarise(avg = mean(n, na.rm = TRUE),
            sd = sd(n, na.rm = TRUE),
            days = n(), .groups = "drop")

weekday_mean <- grp_means$avg[grp_means$weekend == FALSE]
weekend_mean <- grp_means$avg[grp_means$weekend == TRUE]
diff_mean    <- weekend_mean - weekday_mean
ci           <- confint(m_simple)["weekendTRUE", ]  # 95% CI for the difference

cat(sprintf(
  "Weekday mean: %.2f | Weekend mean: %.2f | Difference (weekend - weekday): %.2f\n95%% CI for difference: [%.2f, %.2f]\n",
  weekday_mean, weekend_mean, diff_mean, ci[1], ci[2]
))

```
```{r step4_model_plot, fig.width=8, fig.height=5}

simple_df <- simple_df %>% mutate(pred = predict(m_simple))

simple_df %>%
  ggplot(aes(x = incident_date)) +
  geom_point(aes(y = n, color = "Observed"), alpha = 0.6, size = 1.5) +
  geom_line(aes(y = pred, color = "Fitted"), linewidth = 0.9) +
  scale_color_manual(values = c("Observed" = "#2C7FB8", "Fitted" = "#D95F0E"), name = NULL) +
  labs(
    title = "Observed vs Fitted (Simple Weekend vs Weekday Model)",
    subtitle = "lm(n ~ weekend)",
    x = NULL, y = "Incidents per day"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "top")

```
```{r step5_numbers, message=FALSE, warning=FALSE}
  # Core counts and dates
  total_incidents <- nrow(shootings_unique)
  start_date <- min(city_daily$incident_date, na.rm = TRUE)
  end_date   <- max(city_daily$incident_date, na.rm = TRUE)
  
  # Weekend vs weekday means from the simple model frame
  simple_df <- city_daily %>%
    mutate(
      weekday = lubridate::wday(incident_date, label = TRUE, week_start = 1),
      weekend = weekday %in% c("Sat", "Sun")
    )
  
  weekday_mean <- mean(simple_df$n[!simple_df$weekend], na.rm = TRUE)
  weekend_mean <- mean(simple_df$n[ simple_df$weekend], na.rm = TRUE)
  diff_mean    <- weekend_mean - weekday_mean
  
  # Male vs Female victims (overall, drop unknown/other)
  mf_overall <- raw %>%
    transmute(vic_sex = VIC_SEX) %>%
    filter(vic_sex %in% c("M","F")) %>%
    mutate(vic_sex = ifelse(vic_sex == "M", "Male", "Female")) %>%
    count(vic_sex, name = "n") %>%
    mutate(pct = n / sum(n))
  
  male_pct   <- round(100 * mf_overall$pct[mf_overall$vic_sex == "Male"], 1)
  female_pct <- round(100 * mf_overall$pct[mf_overall$vic_sex == "Female"], 1)

```


```{r}
R.version.string
sessionInfo()

```

